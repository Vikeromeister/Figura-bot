<!DOCTYPE html><html><head><title>Figura Rím Bot</title><style>
		/* CSS styles go here */
	body {
			font-family: Arial, sans-serif;
			background-color: #f5f5f5;
			text-align: center;
			padding-top: 50px;
		}
		input[type="text"] {
			border: none;
			border-radius: 5px;
			padding: 10px;
			font-size: 18px;
			width: 80%;
			max-width: 400px;
			box-shadow: 2px 2px 5px rgba(0,0,0,.2);
			color: #777;
		}
		input[type="text"]:focus {
			outline: none;
			box-shadow: 2px 2px 5px rgba(0,0,0,.4);
		}
		input[type="submit"] {
			background-color: #0077cc;
			border: none;
			border-radius: 5px;
			color: #fff;
			font-size: 18px;
			font-weight: bold;
			padding: 10px 20px;
			margin-left: 10px;
			box-shadow: 2px 2px 5px rgba(0,0,0,.2);
			cursor: pointer;
		}
		input[type="submit"]:hover {
			background-color: #005fa3;
		}
		#results {
            		margin-top: 25px;
            		padding: 10px;
            		border: 1px solid grey;
            		border-radius: 5px;
            		background-color: white;
            		color: #333;
			font-size: 18px;
			text-align: center;
        	}
	</style></head><body><h1>Figura bot</h1><p>Lökj egy sort Figunak!</p><form><input type="text" id="input-text" placeholder="Lökj egy sort Figurának"><input type="submit" id="submit-button" value="Mehet!"></form><div id="results"></div><script>
		// JavaScript code to handle the form submission goes here
		const getVowelsFromString = function(line, no) {
            const vowels = [];
            for (let index = line.length - 1; index >= 0; index--) {
                const letter = line[index].toLowerCase();
                if (["a", "á", "e", "é", "i", "í", "o", "ó", "ö", "ő", "u", "ú", "ü", "ű"].indexOf(letter) !== -1) {
                    vowels.unshift(letter);
                }
                if (vowels.length === no) {
                    break;
                }
            }
            return vowels.join("");
        };

        const compareStrings = function(line1, line2) {
            let i = 1;
            while (getVowelsFromString(line1, i) === getVowelsFromString(line2, i) && getVowelsFromString(line1, i).length === i) {
                i++;
            }
            return i - 1;
        };

        const inputText = document.getElementById("input-text");
        const submitButton = document.getElementById("submit-button");
        const resultsDiv = document.getElementById("results");

        submitButton.addEventListener("click", function(event) {
            event.preventDefault();

            const userInput = inputText.value.trim();
            if (userInput === "") {
                return;
            }

            const sorok = [];  // Empty array to hold the loaded lines

            // Use XMLHttpRequest to load the directory listing for the "szovegek" folder
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "szovegek/");
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        // When the directory listing has been loaded, filter it to get only the .txt files
                        const fileNames = xhr.responseText
                            .split('\n')
                            .filter(fileName => /\.txt$/.test(fileName.trim()));
                            
                        // Use Promise.all() to load all files asynchronously
                        Promise.all(fileNames.map(fileName => {
                            return new Promise((resolve, reject) => {
                                const xhr = new XMLHttpRequest();
                                xhr.open("GET", `szovegek/${fileName}`);
                                xhr.onreadystatechange = function() {
                                    if (xhr.readyState === 4) {
                                        if (xhr.status === 200) {
                                            resolve(xhr.responseText);
                                        } else {
                                            reject(`Error loading ${fileName}: ${xhr.statusText}`);
                                        }
                                    }
                                };
                                xhr.send();
                            });
                        })).then(responses => {
                            // Concatenate the loaded responses into a single array of lines
                            responses.forEach(response => {
                                sorok.push(...response.trim().split('\n'));
                            });

                            const matchedLines = [];
                            let maxMatchingVowels = 0;

                            for (const line of sorok) {
                                const matchingVowels = compareStrings(line, userInput);
                                if (matchingVowels > maxMatchingVowels) {
                                    matchedLines.length = 0;
                                    matchedLines.push(line);
                                    maxMatchingVowels = matchingVowels;
                                } else if (matchingVowels === maxMatchingVowels) {
                                    matchedLines.push(line);
                                }
                            }

                            const resultsText = document.createElement("p");
                            if (maxMatchingVowels > 1) {
                                const chosenLine = matchedLines[Math.floor(Math.random() * matchedLines.length)];
                                resultsText.innerText = `Figura: ${chosenLine}`;
                            } else {
                                resultsText.innerText = "Nincs meccs a bemenettel.";
                            }
                            resultsDiv.innerHTML = "";
                            resultsDiv.appendChild(resultsText);
                        }).catch(error => {
                            const resultsText = document.createElement("p");
                            resultsText.innerText = error;
                            resultsDiv.innerHTML = "";
                            resultsDiv.appendChild(resultsText);
                        });
                    } else {
                        const resultsText = document.createElement("p");
                        resultsText.innerText = `Error loading directory listing for szovegek/: ${xhr.statusText}`;
                        resultsDiv.innerHTML = "";
                        resultsDiv.appendChild(resultsText);
                    }
                }
            };
            xhr.send();
        });
    </script></body></html>
